# Default values for bison.

# Global configuration
global:
  imageRegistry: "ghcr.io/supermarioyl"
  imagePullSecrets: []

# Authentication configuration
auth:
  enabled: false # Enable login authentication
  admin:
    username: admin # Admin username
    password: "" # Admin password (not recommended, use existingSecret)
    existingSecret: "" # Secret containing 'password' key
  jwt:
    secret: "" # JWT signing secret (auto-generated if empty)
    existingSecret: "" # Secret containing 'jwt-secret' key

# External dependencies
# Note: Capsule and OpenCost must be installed separately before deploying Bison
dependencies:
  # Capsule configuration
  capsule:
    # Capsule must be installed separately
    # helm install capsule projectcapsule/capsule -n capsule-system --create-namespace
    enabled: false

  # OpenCost configuration
  opencost:
    # OpenCost must be installed separately
    # helm install opencost opencost/opencost -n opencost --create-namespace
    enabled: false
    # OpenCost API URL (internal service URL) - use port 9003 for API, NOT 9090 (UI)
    apiUrl: "http://opencost.opencost.svc.cluster.local:9003"

  # Prometheus configuration (for node metrics, required by OpenCost)
  prometheus:
    enabled: true
    # Prometheus server URL (kube-prometheus-stack)
    url: "http://prometheus-kube-prometheus-prometheus.monitoring:9090"

# API Server configuration
apiServer:
  enabled: true
  replicaCount: 2
  image:
    repository: bison/api-server
    tag: "" # Defaults to Chart.AppVersion if empty
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 8080
  resources:
    limits:
      cpu: 1000m
      memory: 512Mi
    requests:
      cpu: 200m
      memory: 256Mi
  nodeSelector: {}
  tolerations: []
  affinity: {}

# Web UI configuration
webUI:
  enabled: true
  replicaCount: 2
  image:
    repository: bison/web-ui
    tag: "" # Defaults to Chart.AppVersion if empty
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 80
  resources:
    limits:
      cpu: 500m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi
  nodeSelector: {}
  tolerations: []
  affinity: {}

# Ingress (unified entry point, web-ui nginx proxies /api to api-server)
ingress:
  enabled: true
  className: ""
  annotations: {}
  host: bison.example.com
  tls:
    enabled: false
    secretName: "" # If empty, auto-generated as <release>-tls

# Service account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

# Container security context
securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL
